<div class="center-block col-md-8 col-xs-12 col-sm-6">
	<div class="avatar">
		<%= image_tag @instructor.avatar_url(:thumb) %>
	</div>
	<h1><%= @instructor.teacher.joined_fields :first_name, :last_name %></h1>

	<div class="teacher-fields">
		<p>
			From: <strong> <%= @instructor.country_of_origin %> </strong> <br>
			First Language: <strong><%= @instructor.first_language.capitalize %> </strong> <br>
			Subject to teach: <strong><%= @instructor.subject_to_teach %></strong><br>
			Education level: <strong><%= @instructor.education %></strong><br>
			Time Zone: <strong><%= @instructor.teacher.city_time_zone %></strong> <br> <br>
			Price per teaching hour: <%= "#{@instructor.price.format} #{@instructor.price.currency}" %> <br>
			
			<% if @instructor.document.blank? == false %>
				<strong> <%= "#{@instructor.teacher.first_name.capitalize}'s Docs: " %> </strong>
				<%= link_to "Download Resume", @instructor.document_url %>
			<% else %>
				<i><%= "No CV uploaded." %></i>
			<% end %>
		</p>

		<div class="about-teacher lead">
			<h3>About <%= @instructor.teacher.first_name.capitalize%>:</h3>
			<p><%= @instructor.about%></p>
		</div>
	</div>

	<% if @instructor.teacher == current_user %>
		<%= link_to edit_instructor_url(@instructor), class: 'btn btn-info btn-sm' do %>
		<i class="glyphicon glyphicon-plus"> </i> Edit your information
		<% end %>

		<%= link_to new_instructor_timeslot_path(@instructor), id:'add_availability_link', remote: true, class: 'btn btn-success btn-sm' do %>
		<i class="glyphicon glyphicon-plus"></i> Select your Availability <br>
		<% end %>
	<% end %>


<!-- Need to ensure current user is not the rendered instructors profile!!!!! -->
<!-- need to fix this page! the calendar border is over the teacher's profile!! -->
<% if current_user != nil %>
	<div id="timeslots">
		<% @instructor.timeslots.each do |timeslot| %>
			<%= render partial: 'timeslots/timeslot', locals: {timeslot: timeslot} %>
		<% end %>
<% else %> 
	<p><i> <%= link_to "Login", new_session_path %> to book a time with this teacher.</i></p>
	</div>
<% end %>
	</div>

<div class='teacher_calendar'>
<% timezone = current_user.city_time_zone if current_user.present? %>
</div>

<script>
	$('.teacher_calendar').fullCalendar({
    
    select: function( start, end, jsEvent, view ) {
      console.log(start, end);
    },

    // selectable: true,
		
    header: {
			left: 'prev, next',
			center:'title',
			right: 'today,month,agendaWeek,agendaDay'
		},
		
    eventSources: [
      {
        url: '/instructors/<%= @instructor.id %>/timeslots',
        backgroundColor: '#6cf62c',
        textColor: '#DDF4FF',
        rendering: 'background',
        borderColor: 'black',
        className: 'instructor_availability'
      },
      
      {
        url: "/instructors/<%= @instructor.id %>/bookings",
        textColor: '#000E15',
        borderColor: 'black',
        backgroundColor: '#9DD6F2'
      }
    ],

		defaultView: "agendaWeek",
		timezone: "<%= timezone %>",
		// timezone: <= current_user.city_time_zone %>,
		displayEventEnd: {
        month: true,
        basicWeek: true,
        "default": true
    },

    theme: true,
    views: {
        month: { // name of view
            titleFormat: 'YYYY, MM, DD'
            // other view-specific options here
        }
      },
    dayClick: function(calEvent, jsEvent, view) {
      if (jsEvent.target.classList.contains('fc-bgevent')) {
            $('#fullCalModal').modal({
              backdrop: 'static',
            });
        }
      }
	}); 

</script>




<% booking_approaching = current_user.bookings.any? do |booking|%>
  <% Time.zone.now < booking.start_time-15.minutes && Time.zone.now <= booking.end_time+10.minutes %>
<% end %>

<% if current_user.instructor != nil %>
  <% teaching_approaching = current_user.instructor.bookings.any? do |booking|%>
    <% Time.zone.now < booking.start_time-15.minutes && Time.zone.now <= booking.end_time+10.minutes %>
  <% end %>
<% end %>

<% if booking_approaching || teaching_approaching %>
  <button id ='render_video' type="button" class="btn btn-primary" data-toggle="modal" data-target="#bookingModal">Start Your Lesson!</button>
  <script>

    $('#render_video').click(function(){
       RTC();
    });

    $('#bookingModal').modal({
      backdrop: 'static',
      keyboard: false,
    });

  </script>
<% end %>


<div class="modal fade" id="bookingModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span> <span class="sr-only">close</span></button>
          <h4 id="modalTitle" class="modal-title"></h4>
      </div>
        <div class="modal-body">

          <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">

          <div class="pure-u-1-5">
            <div id="l-video"></div>
          </div>

          <div class="pure-u-4-5" id="r-video"></div>
          <script src="https://cdn.jsdelivr.net/rtc/latest/rtc.min.js"></script>

        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="fullCalModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span> <span class="sr-only">close</span></button>
          <h4 id="modalTitle" class="modal-title">Booking Form</h4>
      </div>

        <div class="modal-body">
          @timeslot = 
          <%= form_for([@instructor, @timeslot, @booking]) do |f| %>
            <div class="field">
              <%= f.label :start_time %>
              <%= f.datetime_select :start_time, discard_year: true, minute_step: 15, ampm: true %>
            </div>

            <div class="field">
              <%= f.label :end_time %>
              <%= f.datetime_select :end_time, discard_year: true, minute_step: 15, ampm: true %>
            </div>  

        </div>
        
        <div class="modal-footer form-group">
          <button type="submit" name="commit" class="btn btn-md btn-primary">Make this Booking!</button>
        </div>
      <% end %>
    </div>
  </div>
</div>